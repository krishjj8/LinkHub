<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkHub - Pro Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            --primary: #ff5e00;
            --accent: #00d2ff;
            --bg-dark: #0f172a; /* Deep Navy Blue */
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-color: #e2e8f0;
        }

        /* FUTURISTIC DARK BACKGROUND */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            /* Subtle Mesh Gradient */
            background-image:
                radial-gradient(at 0% 0%, rgba(255, 94, 0, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(0, 210, 255, 0.15) 0px, transparent 50%);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 480px;
            /* Glassmorphism Effect */
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 40px;
            border-radius: 24px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease;
        }

        .container:hover { transform: translateY(-5px); }

        /* PROFESSIONAL LOGO */
        h1.logo {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 3em;
            margin: 0 0 10px 0;
            text-align: center;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -1px;
        }

        p {
            font-size: 1rem;
            text-align: center;
            margin-bottom: 30px;
            color: #94a3b8;
            font-weight: 400;
        }

        /* MODERN INPUTS */
        input {
            width: 100%;
            padding: 16px;
            margin: 10px 0;
            border: 1px solid #334155;
            border-radius: 12px;
            box-sizing: border-box;
            font-size: 16px;
            font-family: 'Inter', sans-serif;
            background: rgba(15, 23, 42, 0.6);
            color: white;
            transition: all 0.2s;
        }
        input:focus {
            border-color: var(--accent);
            outline: none;
            box-shadow: 0 0 0 2px rgba(0, 210, 255, 0.2);
        }

        /* MODERN BUTTONS */
        button {
            width: 100%;
            padding: 16px;
            margin-top: 20px;
            background: linear-gradient(90deg, var(--primary), #ff9100);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            font-family: 'Poppins', sans-serif;
            transition: transform 0.1s, box-shadow 0.2s;
            box-shadow: 0 4px 15px rgba(255, 94, 0, 0.3);
        }
        button:hover { box-shadow: 0 6px 20px rgba(255, 94, 0, 0.4); transform: translateY(-1px); }
        button:active { transform: translateY(1px); }

        button.secondary {
            background: transparent;
            border: 1px solid #475569;
            box-shadow: none;
            color: #94a3b8;
        }
        button.secondary:hover { border-color: #94a3b8; color: white; }

        /* LINK CARDS */
        .link-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            margin: 15px 0;
            border-radius: 16px;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }
        .link-card:hover { background: rgba(255, 255, 255, 0.08); }

        .link-info { flex-grow: 1; text-align: left; padding-right: 15px; overflow: hidden; }
        .link-title {
            font-weight: 600;
            font-size: 1.1em;
            color: #f1f5f9;
            text-decoration: none;
            display: block;
            font-family: 'Poppins', sans-serif;
        }
        .link-url {
            font-size: 0.85em;
            color: #64748b;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            display: block;
            margin-top: 4px;
        }

        .actions { display: flex; gap: 10px; }
        .icon-btn {
            width: 36px; height: 36px; border-radius: 10px; border: none;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            color: white; margin: 0; padding: 0; box-shadow: none;
        }
        .btn-edit { background: rgba(0, 210, 255, 0.15); color: var(--accent); }
        .btn-edit:hover { background: var(--accent); color: #000; }

        .btn-delete { background: rgba(255, 77, 77, 0.15); color: #ff4d4d; }
        .btn-delete:hover { background: #ff4d4d; color: white; }

        /* TOAST */
        #toast { visibility: hidden; min-width: 250px; background-color: #0f172a; color: #fff; text-align: center; border-radius: 50px; padding: 16px; position: fixed; z-index: 100; left: 50%; bottom: 30px; transform: translateX(-50%); font-family: 'Inter', sans-serif; border: 1px solid var(--accent); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        #toast.show { visibility: visible; animation: popin 0.5s, fadeout 0.5s 2.5s; }
        @keyframes popin { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }

        /* MODAL */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(5px);
            display: none; justify-content: center; align-items: center; z-index: 1000;
        }
        .modal-overlay.show { display: flex; }
        .modal-content { max-width: 400px; }
        #modal-title { margin-top: 0; color: var(--accent); font-family: 'Poppins', sans-serif; }
    </style>
</head>
<body>

<div class="container">
    <div id="login-screen">
        <h1 class="logo">LinkHub</h1>
        <p>Your digital universe, one link at a time.</p>
        <input type="text" id="usernameInput" placeholder="Enter Username">
        <button onclick="handleLogin()">Launch Profile</button>
    </div>

    <div id="dashboard-screen" style="display:none;">
        <div style="text-align:center; border-bottom: 1px solid var(--glass-border); padding-bottom: 20px; margin-bottom: 20px;">
            <h1 class="logo" style="font-size: 2em; margin:0;">LinkHub</h1>
            <span id="displayUsername" style="background: rgba(255,255,255,0.1); color: #94a3b8; padding: 6px 16px; border-radius: 20px; font-size: 0.9em; letter-spacing: 0.5px;">@user</span>
            <br><br>
            <button class="secondary" onclick="logout()" style="width: auto; padding: 8px 24px; font-size: 0.9rem; margin-top: 10px;">Log Out</button>
        </div>

        <div style="background: rgba(255,255,255,0.03); padding: 20px; border-radius: 16px; border: 1px solid var(--glass-border);">
            <h3 style="margin:0 0 15px 0; font-family: 'Poppins', sans-serif; color: var(--accent); font-size: 1.1em;" id="formTitle">Add New Link</h3>
            <input type="hidden" id="editLinkId">
            <input type="text" id="linkTitle" placeholder="Title (e.g. My Portfolio)">
            <input type="url" id="linkUrl" placeholder="URL (e.g. https://portfolio.com)">
            <div style="display:flex; gap:10px;">
                <button onclick="saveLink()" id="saveBtn">Save Link</button>
                <button onclick="cancelEdit()" id="cancelBtn" class="secondary" style="display:none;">Cancel</button>
            </div>
        </div>

        <div id="links-list" style="margin-top: 25px;"></div>
    </div>
</div>

<div id="toast">Message</div>

<div id="custom-modal" class="modal-overlay">
    <div class="modal-content container">
        <h3 id="modal-title">Confirmation</h3>
        <p id="modal-message" style="margin-bottom: 25px; color: #e2e8f0;">Are you sure?</p>
        <div style="display:flex; gap:10px; justify-content: flex-end;">
            <button id="modal-cancel-btn" class="secondary" style="width: auto; padding: 8px 24px; font-size: 0.9rem; margin-top: 0;">Cancel</button>
            <button id="modal-confirm-btn" style="width: auto; padding: 8px 24px; font-size: 0.9rem; margin-top: 0;">Confirm</button>
        </div>
    </div>
</div>

<script>
    let CURRENT_USER = null;
    const API_BASE = "/api/v1";

    // --- MODAL FUNCTIONALITY ---
    function showModal(title, message, confirmText = "Confirm") {
        const modal = document.getElementById('custom-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const confirmBtn = document.getElementById('modal-confirm-btn');
        const cancelBtn = document.getElementById('modal-cancel-btn');

        modalTitle.textContent = title;
        modalMessage.textContent = message;
        confirmBtn.textContent = confirmText;
        modal.classList.add('show');

        return new Promise((resolve) => {
            const close = (result) => {
                modal.classList.remove('show');
                confirmBtn.onclick = null;
                cancelBtn.onclick = null;
                resolve(result);
            };

            confirmBtn.onclick = () => close(true);
            cancelBtn.onclick = () => close(false);
        });
    }

    async function handleLogin() {
        const username = document.getElementById('usernameInput').value.trim();
        const HIDDEN_PASSWORD = "public_access_123";

        if(!username) return showToast("Please enter a name!");

        try {
            const res = await fetch(`${API_BASE}/users`);
            const users = await res.json();
            const foundUser = users.find(u => u.username.toLowerCase() === username.toLowerCase());

            if (foundUser) {
                CURRENT_USER = foundUser;
                showToast(`Welcome back, ${CURRENT_USER.username}!`);
                loadDashboard();
            } else {
                // Use custom modal instead of browser confirm
                const confirmed = await showModal(
                    "Create Account?",
                    `User '${username}' is new. Would you like to create a new profile?`,
                    "Create Profile"
                );
                if(confirmed) {
                    await registerUser(username, HIDDEN_PASSWORD);
                }
            }
        } catch (err) {
            console.error(err);
            // Removed emoji
            showToast("Connection Error.");
        }
    }

    async function registerUser(username, password) {
        try {
            const res = await fetch(`${API_BASE}/users`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, email: `${username}@linkhub.com`, password })
            });

            if (res.ok) {
                CURRENT_USER = await res.json();
                // Removed emoji
                showToast("Account Created!");
                loadDashboard();
            } else {
                showToast("Name taken or invalid.");
            }
        } catch (err) { showToast("Registration Failed."); }
    }

    function logout() {
        CURRENT_USER = null;
        document.getElementById('dashboard-screen').style.display = 'none';
        document.getElementById('login-screen').style.display = 'block';
        document.getElementById('usernameInput').value = '';
    }

    function loadDashboard() {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('dashboard-screen').style.display = 'block';
        document.getElementById('displayUsername').textContent = `@${CURRENT_USER.username}`;
        fetchLinks();
    }

    async function fetchLinks() {
        const list = document.getElementById('links-list');
        list.innerHTML = '<p style="color:#94a3b8">Syncing data...</p>';

        try {
            const res = await fetch(`${API_BASE}/users/${CURRENT_USER.id}/links`);
            const links = await res.json();
            list.innerHTML = '';

            if (links.length === 0) {
                list.innerHTML = '<p style="color:#94a3b8">No links found. Add your first one!</p>';
                return;
            }

            links.forEach(link => {
                const card = document.createElement('div');
                card.className = 'link-card';
                card.innerHTML = `
                    <div class="link-info">
                        <a href="${link.url}" target="_blank" class="link-title">${link.title}</a>
                        <span class="link-url">${link.url}</span>
                    </div>
                    <div class="actions">
                        <button class="icon-btn btn-edit" onclick="startEdit(${link.id}, '${link.title}', '${link.url}')">
                            <i class="fas fa-pencil-alt"></i>
                        </button>
                        <button class="icon-btn btn-delete" onclick="deleteLink(${link.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                list.appendChild(card);
            });
        } catch (err) { list.innerHTML = '<p style="color:red">Signal Lost.</p>'; } // Removed emoji
    }

    async function saveLink() {
        const title = document.getElementById('linkTitle').value;
        const url = document.getElementById('linkUrl').value;
        const editId = document.getElementById('editLinkId').value;

        if (!title || !url) return showToast("Please fill in all fields.");

        const payload = { title, url };
        let apiUrl = `${API_BASE}/users/${CURRENT_USER.id}/links`;
        let method = 'POST';

        if (editId) {
            apiUrl += `/${editId}`;
            method = 'PUT';
        }

        try {
            const res = await fetch(apiUrl, {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (res.ok) {
                showToast(editId ? "Link Updated!" : "Link Added!");
                cancelEdit();
                fetchLinks();
            } else { showToast("Error saving link."); }
        } catch (err) { console.error(err); }
    }

    async function deleteLink(linkId) {
        // Use custom modal instead of browser confirm
        const confirmed = await showModal(
            "Delete Link?",
            "Are you sure you want to remove this link? This action cannot be undone.",
            "Delete"
        );
        if(!confirmed) return;

        try {
            const res = await fetch(`${API_BASE}/users/${CURRENT_USER.id}/links/${linkId}`, { method: 'DELETE' });
            if (res.ok) { showToast("Deleted."); fetchLinks(); }
        } catch (err) { console.error(err); }
    }

    function startEdit(id, title, url) {
        // Removed emoji
        document.getElementById('formTitle').textContent = "Edit Link";
        document.getElementById('saveBtn').textContent = "Update";
        document.getElementById('cancelBtn').style.display = "inline-block";
        document.getElementById('editLinkId').value = id;
        document.getElementById('linkTitle').value = title;
        document.getElementById('linkUrl').value = url;
    }

    function cancelEdit() {
        // Removed emoji
        document.getElementById('formTitle').textContent = "Add New Link";
        document.getElementById('saveBtn').textContent = "Save Link";
        document.getElementById('cancelBtn').style.display = "none";
        document.getElementById('editLinkId').value = '';
        document.getElementById('linkTitle').value = '';
        document.getElementById('linkUrl').value = '';
    }

    function showToast(msg) {
        const x = document.getElementById("toast");
        x.textContent = msg;
        x.className = "show";
        setTimeout(() => { x.className = x.className.replace("show", ""); }, 3000);
    }
</script>
</body>
</html>